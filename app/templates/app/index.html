{% extends 'app/layout.html' %}

{% block title %}Visualize Diversity Against Annotated 16s rRNA Microbial Profiles{% endblock %}
{% block content %}
  <div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      <h1>
        Visibiome (alpha release)<br>
        <small>A webserver to Visualize Diversity Against Annotated 16s rRNA Microbial Profiles</small>
      </h1>
      <p>
        Analyze your 16s rRNA sample against the reference database. Need help?
        Check out the <a href="{% url 'app:help' %}">help pages</a> for
        information on what to submit. You could also
        <a href="{% url 'app:example_job_details' %}">view a pre-run job</a>
      </p>

      {% if user.is_authenticated %}
        <form class="form-horizontal" action="{% url "app:search" %}" method="post" enctype="multipart/form-data" id="biom-search-form">
      {% else %}
        <form class="form-horizontal" action="{% url "app:guest_search" %}" method="post" enctype="multipart/form-data" id="biom-search-form">
      {% endif %}
        {% csrf_token %}
        <div class="form-group">
          <label for="{{ form.name.name }}" class="col-xs-12 col-sm-3 control-label">
            {{ form.name.label }}<br>
          </label>
          <div class="col-xs-12 col-sm-9">
            {{ form.name.as_widget }}

            {% if form.name.errors %}
              <ul class="errorlist">
                {% for e in form.name.errors %}
                  <li>{{ e }}</li>
                {% endfor %}
              </ul>
            {% endif %}
          </div>
        </div>
        <div class="form-group">
          <label for="{{ form.otu_text.name }}" class="col-xs-12 col-sm-3 control-label">{{ form.otu_text.label }}<br>
            <em>Maximum 10 samples (TSV/JSON format)</em><br>
            <em>GreenGenes 13.5 OTUs only!</em>
          </label>
          <div class="col-xs-12 col-sm-9">
            {{ form.otu_text.as_widget }}

            {% if form.otu_text.errors %}
              <ul class="errorlist">
                {% for e in form.otu_text.errors %}
                  <li>{{ e }}</li>
                {% endfor %}
              </ul>
            {% endif %}
          </div>
        </div>

        <div class="form-group">
          <label for="{{ form.biom_file.name }}" class="col-xs-12 col-sm-3 control-label">
            {{ form.biom_file.label }}<br>
            <em>Maximum 10 samples (TSV/JSON format)</em><br>
            <em>GreenGenes 13.5 OTUs only!</em>
          </label>
          <div class="col-xs-12 col-sm-9">
            {{ form.biom_file.as_widget }}

            {% if form.biom_file.errors %}
              <ul class="errorlist">
                {% for e in form.biom_file.errors %}
                  <li>{{ e }}</li>
                {% endfor %}
              </ul>
            {% endif %}
          </div>
        </div>

        <hr>
        <div class="form-group">
          <label for="ecosystem" class="col-xs-12 col-sm-3 control-label">
            {{ form.criteria.label }}<br><em>All or max 3</em>
          </label>
          <div class="col-xs-12 col-sm-9">
            <div class="row">
              {% for ecosystem in form.criteria %}
                {% if forloop.counter0|divisibleby:3 %}
                  <div class="col-xs-4">
                {% endif %}
                    <div class="checkbox checkbox-criteria">
                      {{ ecosystem }}
                    </div>
                {% if forloop.counter|divisibleby:3 %}
                  </div>
                {% endif %}
              {% endfor %}

              {% if form.criteria.errors %}
                <ul class="errorlist">
                  {% for e in form.criteria.errors %}
                    <li>{{ e }}</li>
                  {% endfor %}
                </ul>
              {% endif %}
            </div>
          </div>
        </div>

        <hr>
        <div class="form-group">
          <label for="{{ form.analysis_type.name }}" class="col-xs-12 col-sm-3 control-label">
            {{ form.analysis_type.label }}<br>
          </label>
          <div class="col-xs-12 col-sm-2">
            <div class="row">
              <div class="col-xs-12">
                {{ form.analysis_type.as_widget }}
              </div>
            </div>
          </div>

          <label for="{{ form.range_query_value.name }}" class="col-xs-12 col-sm-2 control-label">
            {{ form.range_query_value.label }}<br>
          </label>
          <div class="col-xs-12 col-sm-5">
            <div class="row">
              <div class="col-xs-12">
                {{ form.range_query_value.as_widget }}
              </div>
            </div>
          </div>
        </div>

        <hr>
        <div class="form-group">
          <label for="is_normalized_otu" class="col-xs-12 col-sm-3 control-label">
            {{ form.is_normalized_otu.label }}<br><em>(optional)</em>
          </label>
          <div class="col-xs-12 col-sm-2">
            <div class="row">
              <div class="col-xs-12">
                {{ form.is_normalized_otu.as_widget }}
              </div>
            </div>
          </div>

          <label for="alpha_rarefaction_flag" class="col-xs-12 col-sm-2 control-label">
            {{ form.alpha_rarefaction_flag.label }}<br><em>(optional)</em>
          </label>
          <div class="col-xs-12 col-sm-5">
            <div class="row">
              <div class="col-xs-12">
                {{ form.alpha_rarefaction_flag.as_widget }}
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-12 col-sm-3 col-xs-offset-9">
            <input type="submit" name="submit" id="submit" value="Analyze" class="btn btn-primary">
          </div>
        </div>
      </form>
    </div>
  </div>

{% endblock %}
