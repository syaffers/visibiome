{% extends "app/layout.html" %}

{% block title %}Jobs Dashboard{% endblock %}
{% block content %}
  <h2>Dashboard</h2>
  {% if jobs %}
  <h3>Jobs list</h3>
  <table id="table-dashboard" class="table table-striped table-hover">
  	<thead>
  		<tr>
  			<th width="12.5%">Name</th>
  			<th width="12.5%">Criteria</th>
  			<th width="10%">Status</th>
        <th width="16%">Start time</th>
        <th width="16%">Completion time</th>
        <th width="28%">Error messages</th>
        <th width="2.5%">Remove</th>
        <th width="2.5%">Re-run</th>
  		</tr>
  	</thead>
  	<tbody>
      {% for job in jobs %}
        <tr>
          <td>
            <a class="btn btn-primary btn-xs" href="{% url 'app:job_details' job.pk %}">
              {{ job.name }}
            </a>
          </td>
          <td>
            {% for criterion in job.criteria.all %}
              <span class="criterion">{{ criterion }}</span>
            {% endfor %}
          </td>
          <td>
            {{ job.get_status_display }}
          </td>
          <td>
            {{ job.created_at }}
          </td>
          <td>
            {% if job.status < 10 %}
              -
            {% else %}
              {{ job.updated_at }}
            {% endif %}
          </td>
          <td>
            {{ job.get_error_code_display }}
          </td>
          <td class="td-btn">
            <button data-remove-url="{% url 'app:job_remove' job.pk %}"
                    class="btn btn-danger btn-job btn-job-remove" type="submit">
              <span class="glyphicon glyphicon-remove"></span>
            </button>
          </td>
          <td class="td-btn">
            <button data-rerun-url="{% url 'app:job_rerun' job.pk %}"
                    class="btn btn-warning btn-job btn-job-rerun
                           {% if job.status == job.QUEUED or job.status == job.PROCESSING %}
                             disabled
                           {% endif %}" type="submit">
              <span class="glyphicon glyphicon-step-backward"></span>
            </button>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  {% else %}
    <span class="jumbo">
      You have no jobs running or completed.
      Run a new search by clicking "New Search" above
    </span>
  {% endif %}
  </table>

{% endblock %}
