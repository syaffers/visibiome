{% extends "job/job_base.html" %}
{% load static from staticfiles %}

{% block title %}PCoA Plot of 250 Most Similar Samples for Job #{{ job.id }}{% endblock %}
{% block job_page %}
  <h2>PCoA Plot of 250 Most Similar Samples</h2>

  <p>
    The clusterability of the sample against the selected environments is
    confirmed by visually inspecting Principal Coordinate Analysis (PCoA) plots.
    The first option (default) of Ecosystem clusters samples on the basis of
    Ecosystem definition, while the second option clusters samples on the basis
    of EnvO(s). User Sample is given "Unknown" identity. Hover your mouse on the
    points to view more details regarding the Environmental Context. These PCoA
    plots are made with 250 most similar samples based upon the Bray-Curtis
    distance.
  </p>

  <div class="btn-group" role="group">
    <button type="button" id="view-by-eco" class="active btn btn-primary">
      View by Ecosystem
    </button>
    <button type="button" id="view-by-envo" class="btn btn-primary">
      View by EnvO
    </button>
  </div>

  <div class="btn-group" role="group">
    <button type="button" id="toggle-user-sample" class="active btn btn-warning">
      Toggle query label
    </button>
  </div>

  <!-- Graph generated by pcoa.js -->
  <div id="legend"></div>
  <div id="plots">
    <h3>
      PC1 vs. PC2
      <a href="#" class="download-link btn btn-info btn-sm" data-plot="pcoa-pc1-pc2">
        <span class="glyphicon glyphicon-download"></span>
        Download
      </a>
    </h3>
    <div class="plot-container">
      <div id="pcoa-pc1-pc2"></div>
      <div id="pcoa-pc1-pc2-tooltip"></div>
    </div>
    <h3>
      PC1 vs. PC3
      <a href="#" class="download-link btn btn-info btn-sm" data-plot="pcoa-pc1-pc3">
        <span class="glyphicon glyphicon-download"></span>
        Download
      </a>
    </h3>
    <div class="plot-container">
      <div id="pcoa-pc1-pc3"></div>
      <div id="pcoa-pc1-pc3-tooltip"></div>
    </div>
    <h3>
      PC2 vs. PC3
      <a href="#" class="download-link btn btn-info btn-sm" data-plot="pcoa-pc2-pc3">
        <span class="glyphicon glyphicon-download"></span>
        Download
      </a>
    </h3>
    <div class="plot-container">
      <div id="pcoa-pc2-pc3"></div>
      <div id="pcoa-pc2-pc3-tooltip"></div>
    </div>
  </div>

{% endblock %}

{% block lazy_js %}
<script src="http://d3js.org/d3.v3.min.js" type="text/javascript"></script>
<script src="{% static 'js/pcoa.js'%}" type="text/javascript"></script>
<script>
  var dataPath = "{{data_path}}";
  var sampleId = "{{job.sample_name}}";
  $(document).ready(function () {
    drawPcoa(dataPath, "pcoa_250.csv", sampleId);
  });
</script>
{% endblock %}
